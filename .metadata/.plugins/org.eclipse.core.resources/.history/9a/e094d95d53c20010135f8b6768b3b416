package com.flightbooking.service;

import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;

import com.flightbooking.dao.PaymentDao;
import com.flightbooking.dto.ResponseStructure;
import com.flightbooking.entity.Payment;

@Service
	public class PaymentService {

	    @Autowired
	    private PaymentDao dao;

	    // Save Payment
	    public ResponseEntity<ResponseStructure<Payment>> savePayment(Payment payment) {
	        ResponseStructure<Payment> structure = new ResponseStructure<Payment>();
	        structure.setStatusCode(HttpStatus.CREATED.value());
	        structure.setMessage("Payment added successfully");
	        structure.setData(dao.savePayment(payment));

	        return new ResponseEntity<ResponseStructure<Payment>>(structure, HttpStatus.CREATED);
	    }

	    // Get All
	    public ResponseEntity<ResponseStructure<List<Payment>>> getAllPayments() {
	        ResponseStructure<List<Payment>> structure = new ResponseStructure<>();
	        structure.setStatusCode(HttpStatus.OK.value());
	        structure.setMessage("All payments retrieved");
	        structure.setData(dao.getAllPayments());

	        return new ResponseEntity<ResponseStructure<List<Payment>>>(structure, HttpStatus.OK);
	    }

	    // Get by ID
	    public ResponseEntity<ResponseStructure<Payment>> getPaymentById(Integer id) {
	        Optional<Payment> opt = dao.getPaymentById(id);

	        if (opt.isEmpty()) {
	            throw new RuntimeException("Payment not found with ID: " + id);
	        }

	        ResponseStructure<Payment> structure = new ResponseStructure<>();
	        structure.setStatusCode(HttpStatus.OK.value());
	        structure.setMessage("Payment found");
	        structure.setData(opt.get());

	        return new ResponseEntity<ResponseStructure<Payment>> (structure, HttpStatus.OK);
	    }

	    // Get by status
	    public ResponseEntity<ResponseStructure<List<Payment>>> getPaymentByStatus(String status) {
	        ResponseStructure<List<Payment>> structure = new ResponseStructure<>();
	        structure.setStatusCode(HttpStatus.OK.value());
	        structure.setMessage("Payments fetched by status");
	        structure.setData(dao.getPaymentByStatus(status));

	        return new ResponseEntity<ResponseStructure<List<Payment>>>(structure, HttpStatus.OK);
	    }

	    // Get payments where amount > value
	    public ResponseEntity<ResponseStructure<List<Payment>>> getPaymentsGreaterThan(Double amount) {
	        ResponseStructure<List<Payment>> structure = new ResponseStructure<>();
	        structure.setStatusCode(HttpStatus.OK.value());
	        structure.setMessage("Payments fetched by amount greater than " + amount);
	        structure.setData(dao.getPaymentsAmountGreaterThan(amount));

	        return new ResponseEntity<ResponseStructure<List<Payment>>> (structure, HttpStatus.OK);
	    }

	    // Get by payment mode
	    public ResponseEntity<ResponseStructure<List<Payment>>> getPaymentByMode(String mode) {
	        ResponseStructure<List<Payment>> structure = new ResponseStructure<>();
	        structure.setStatusCode(HttpStatus.OK.value());
	        structure.setMessage("Payments fetched by mode");
	        structure.setData(dao.getPaymentByMode(mode));

	        return new ResponseEntity<ResponseStructure<List<Payment>>>(structure, HttpStatus.OK);
	    }

	    // Update payment status only
	    public ResponseEntity<ResponseStructure<Payment>> updatePaymentStatus(Integer id, String status) {
	        Optional<Payment> opt = dao.getPaymentById(id);

	        if (opt.isEmpty()) {
	            throw new RuntimeException("Payment not found with ID: " + id);
	        }

	        Payment existing = opt.get();
	        existing.setStatus(status);

	        Payment updated = dao.updatePayment(existing);

	        ResponseStructure<Payment> structure = new ResponseStructure<>();
	        structure.setStatusCode(HttpStatus.OK.value());
	        structure.setMessage("Payment status updated");
	        structure.setData(updated);

	        return new ResponseEntity<ResponseStructure<Payment>>(structure, HttpStatus.OK);
	    }
	}



